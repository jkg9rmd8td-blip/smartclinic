<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>Ù…Ù†ØµØ© Ø§Ù„Ø¹ÙŠØ§Ø¯Ø© Ø§Ù„Ù…Ø¯Ø±Ø³ÙŠØ© Ø§Ù„Ø°ÙƒÙŠØ©</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="Ù…Ù†ØµØ© Ø§Ù„Ø¹ÙŠØ§Ø¯Ø© Ø§Ù„Ù…Ø¯Ø±Ø³ÙŠØ© Ø§Ù„Ø°ÙƒÙŠØ©: Ø¨ÙˆØ§Ø¨Ø§Øª Ø§Ù„Ø·Ø§Ù„Ø¨ ÙˆØ§Ù„Ø·Ø¨ÙŠØ¨ ÙˆÙˆÙ„ÙŠ Ø§Ù„Ø£Ù…Ø± ÙˆØ§Ù„Ø¥Ø¯Ø§Ø±Ø© Ù…Ø¹ ØµÙ„Ø§Ø­ÙŠØ§Øª ÙˆØªÙ†Ù‚Ù„Ø§Øª Ù…ØªÙƒØ§Ù…Ù„Ø©.">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700;800&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg-1: #0d1b2a;
      --bg-2: #15344f;
      --card: rgba(14, 33, 52, 0.72);
      --line: rgba(173, 216, 255, 0.22);
      --text-main: #f4fbff;
      --text-soft: #c3d7e6;
      --student: #38bdf8;
      --doctor: #00b4d8;
      --parent: #34d399;
      --admin: #ffb703;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: "Tajawal", "Noto Kufi Arabic", sans-serif;
      background:
        radial-gradient(900px 500px at 12% 10%, rgba(56, 189, 248, 0.25), transparent 60%),
        radial-gradient(850px 500px at 90% 92%, rgba(34, 197, 94, 0.2), transparent 60%),
        linear-gradient(120deg, var(--bg-1), var(--bg-2));
      color: var(--text-main);
      overflow-x: hidden;
      min-height: 100vh;
    }
    body::before {
      content: "";
      position: fixed;
      inset: 0;
      pointer-events: none;
      opacity: 0.2;
      background-image:
        linear-gradient(to right, rgba(255, 255, 255, 0.18) 1px, transparent 1px),
        linear-gradient(to bottom, rgba(255, 255, 255, 0.18) 1px, transparent 1px);
      background-size: 42px 42px;
    }
    .container {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      padding: 32px 24px 20px;
      max-width: 1240px;
      margin: 0 auto;
      position: relative;
      z-index: 1;
    }
    .top-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 16px;
      margin-bottom: 16px;
      flex-wrap: wrap;
    }
    .badge {
      border: 1px solid var(--line);
      background: rgba(255, 255, 255, 0.05);
      border-radius: 999px;
      font-size: 14px;
      padding: 8px 14px;
      color: var(--text-soft);
      backdrop-filter: blur(8px);
    }
    .status { color: #86efac; font-weight: 700; }
    .status.offline { color: #fca5a5; }
    .title {
      text-align: center;
      font-size: clamp(32px, 5vw, 56px);
      font-weight: 800;
      margin: 16px 0 8px;
      opacity: 0;
      animation: fadeIn 0.9s ease forwards;
    }
    .subtitle {
      text-align: center;
      max-width: 780px;
      margin: 0 auto 28px;
      color: var(--text-soft);
      font-size: clamp(16px, 2.1vw, 20px);
      line-height: 1.65;
      opacity: 0;
      animation: fadeIn 1.2s ease forwards;
      animation-delay: 0.15s;
    }
    .resume-box {
      max-width: 780px;
      margin: 0 auto 18px;
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid var(--line);
      border-radius: 16px;
      padding: 12px;
      display: none;
      gap: 8px;
      align-items: center;
      justify-content: space-between;
      flex-wrap: wrap;
    }
    .resume-meta {
      color: var(--text-soft);
      font-size: 14px;
    }
    .resume-actions {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }
    .resume-btn {
      border: 1px solid var(--line);
      background: rgba(255,255,255,0.03);
      color: var(--text-main);
      border-radius: 10px;
      font: inherit;
      padding: 8px 12px;
      cursor: pointer;
    }
    .roles {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 18px;
      width: 100%;
    }
    .role-card {
      background: var(--card);
      border-radius: 24px;
      padding: 24px 20px;
      text-align: right;
      border: 1px solid var(--line);
      box-shadow: 0 16px 44px rgba(2, 12, 24, 0.35);
      cursor: pointer;
      transition: transform 0.3s ease, box-shadow 0.3s ease, border-color 0.3s ease;
      transform: translateY(20px);
      opacity: 0;
      animation: fadeUp 0.8s ease forwards;
      display: flex;
      flex-direction: column;
      gap: 12px;
      min-height: 220px;
      outline: none;
    }
    .role-card:hover,
    .role-card:focus-visible {
      transform: translateY(-7px);
      box-shadow: 0 24px 60px rgba(0, 0, 0, 0.5);
      border-color: rgba(255, 255, 255, 0.36);
    }
    .icon {
      width: 52px;
      height: 52px;
      display: grid;
      place-items: center;
      font-size: 28px;
      border-radius: 16px;
      margin-bottom: 8px;
      background: rgba(255, 255, 255, 0.08);
    }
    .role-title { font-size: 24px; font-weight: 700; margin: 0; }
    .role-desc { font-size: 15px; color: var(--text-soft); margin: 0; line-height: 1.6; }
    .btn {
      padding: 10px 16px;
      border-radius: 12px;
      border: none;
      font-size: 15px;
      font-weight: 700;
      cursor: pointer;
      color: #fff;
      transition: transform 0.2s ease, filter 0.2s ease;
      margin-top: auto;
      width: fit-content;
    }
    .doctor-btn { background: var(--doctor); }
    .student-btn { background: var(--student); }
    .parent-btn { background: var(--parent); }
    .admin-btn { background: var(--admin); color: #16202a; }
    .btn:hover { filter: brightness(1.08); transform: translateX(-3px); }
    @keyframes fadeIn { to { opacity: 1; } }
    @keyframes fadeUp { to { opacity: 1; transform: translateY(0); } }
    footer {
      text-align: center;
      font-size: 13px;
      color: #96adbf;
      margin-top: 28px;
      line-height: 1.8;
    }
    @media (max-width: 700px) {
      .container { padding: 22px 14px 16px; }
      .role-card { min-height: 200px; }
    }
  </style>
</head>
<body>
<div class="container">
  <div class="top-bar">
    <div class="badge">Ø§Ù„Ø¹ÙŠØ§Ø¯Ø© Ø§Ù„Ù…Ø¯Ø±Ø³ÙŠØ© Ø§Ù„Ø°ÙƒÙŠØ© â€¢ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„Ø­Ø§Ù„ÙŠØ©: <strong data-session-role>Ø²Ø§Ø¦Ø±</strong></div>
    <div class="badge"><span id="api-dot" class="status">â—</span> <span id="api-status">Ø¬Ø§Ø±Ù ÙØ­Øµ Ø­Ø§Ù„Ø© Ø§Ù„Ù†Ø¸Ø§Ù…...</span></div>
  </div>

  <div class="title">Ù…Ù†ØµØ© Ø§Ù„Ø¹ÙŠØ§Ø¯Ø© Ø§Ù„Ù…Ø¯Ø±Ø³ÙŠØ© Ø§Ù„Ø°ÙƒÙŠØ©</div>
  <p class="subtitle">Ø¨ÙˆØ§Ø¨Ø© Ù…ÙˆØ­Ø¯Ø© Ù„Ø£Ø¯ÙˆØ§Ø± Ø§Ù„Ù…Ù†ØµØ© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©: Ø§Ù„Ø·Ø§Ù„Ø¨ØŒ Ø§Ù„Ø·Ø¨ÙŠØ¨ØŒ ÙˆÙ„ÙŠ Ø§Ù„Ø£Ù…Ø±ØŒ ÙˆØ§Ù„Ø¥Ø¯Ø§Ø±Ø© Ù…Ø¹ Ø¯Ø®ÙˆÙ„ Ø­Ø³Ø¨ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª.</p>
  <div id="resume-box" class="resume-box">
    <div id="resume-meta" class="resume-meta">Ø¬Ù„Ø³Ø© Ø³Ø§Ø¨Ù‚Ø© Ù…ØªØ§Ø­Ø©.</div>
    <div class="resume-actions">
      <button class="resume-btn" onclick="continueSession()">Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ø¬Ù„Ø³Ø©</button>
      <button class="resume-btn" onclick="openCareCenter()">ÙØªØ­ Ù…Ø±ÙƒØ² Ø§Ù„ØªÙ†Ø³ÙŠÙ‚</button>
    </div>
  </div>

  <div class="roles">
    <div class="role-card" onclick="openSecureRoute('src/pages/student-portal.html', 'student')" onkeydown="cardKey(event, 'src/pages/student-portal.html', 'student')" tabindex="0" style="animation-delay:0.2s;"><div class="icon">ğŸ“</div><div class="role-title">Ø§Ù„Ø·Ø§Ù„Ø¨</div><div class="role-desc">Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„Ø·Ø§Ù„Ø¨ Ù„Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ø°Ø§ØªÙŠØ©: Ø§Ù„Ù…Ù„Ù Ø§Ù„ØµØ­ÙŠØŒ Ø§Ù„Ø·Ù„Ø¨Ø§ØªØŒ ÙˆØ§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ø§Ù„Ù…Ø¯Ø±Ø³ÙŠØ©.</div><button class="btn student-btn">Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø·Ø§Ù„Ø¨</button></div>
    <div class="role-card" onclick="openSecureRoute('src/pages/doctor.html', 'doctor')" onkeydown="cardKey(event, 'src/pages/doctor.html', 'doctor')" tabindex="0" style="animation-delay:0.35s;"><div class="icon">ğŸ©º</div><div class="role-title">Ø§Ù„Ø·Ø¨ÙŠØ¨</div><div class="role-desc">ØªØ´Ø®ÙŠØµ Ø§Ù„Ø­Ø§Ù„Ø©ØŒ Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ø³Ø¬Ù„ Ø§Ù„ØµØ­ÙŠØŒ ÙˆØªÙˆØµÙŠØ§Øª Ø¹Ù„Ø§Ø¬ÙŠØ© Ù…Ø¯Ø¹ÙˆÙ…Ø© Ø¨Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª.</div><button class="btn doctor-btn">Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø·Ø¨ÙŠØ¨</button></div>
    <div class="role-card" onclick="openSecureRoute('src/pages/parent-portal.html', 'parent')" onkeydown="cardKey(event, 'src/pages/parent-portal.html', 'parent')" tabindex="0" style="animation-delay:0.5s;"><div class="icon">ğŸ‘¨â€ğŸ‘©â€ğŸ‘§</div><div class="role-title">ÙˆÙ„ÙŠ Ø§Ù„Ø£Ù…Ø±</div><div class="role-desc">Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„ØµØ­ÙŠØ© Ù„Ù„Ø§Ø¨Ù†ØŒ Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±ØŒ ÙˆØ§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø§Ù„Ø¹ÙŠØ§Ø¯Ø© Ø§Ù„Ù…Ø¯Ø±Ø³ÙŠØ©.</div><button class="btn parent-btn">Ø¯Ø®ÙˆÙ„ ÙˆÙ„ÙŠ Ø§Ù„Ø£Ù…Ø±</button></div>
    <div class="role-card" onclick="openSecureRoute('src/pages/admin-dashboard.html', 'admin')" onkeydown="cardKey(event, 'src/pages/admin-dashboard.html', 'admin')" tabindex="0" style="animation-delay:0.65s;"><div class="icon">ğŸ›ï¸</div><div class="role-title">Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</div><div class="role-desc">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù†Ø¸Ø§Ù…ØŒ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§ØªØŒ ÙˆÙ…Ø¤Ø´Ø±Ø§Øª Ø§Ù„Ø£Ø¯Ø§Ø¡ Ø§Ù„ØªØ´ØºÙŠÙ„ÙŠØ© Ù„Ù„Ø¹ÙŠØ§Ø¯Ø© Ø§Ù„Ù…Ø¯Ø±Ø³ÙŠØ©.</div><button class="btn admin-btn">Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</button></div>
  </div>

  <footer>
    Ù†Ø³Ø®Ø© Ø¹Ø±Ø¶ Ø­ÙƒÙˆÙ…ÙŠ â€¢ 2026
    <br>
    Smart School Clinic Platform
  </footer>
</div>

<script src="assets/js/security.js"></script>
<script>
function updateRoleBadge() {
  var session = SmartClinicSecurity.getSession();
  var label = session ? SmartClinicSecurity.roles[session.role] : 'Ø²Ø§Ø¦Ø±';
  document.querySelectorAll('[data-session-role]').forEach(function (el) { el.textContent = label; });
  refreshResumeActions();
}

function refreshResumeActions() {
  var box = document.getElementById('resume-box');
  var meta = document.getElementById('resume-meta');
  var session = SmartClinicSecurity.getSession();
  if (!session) {
    box.style.display = 'none';
    return;
  }
  var roleLabel = SmartClinicSecurity.roles[session.role] || session.role;
  meta.textContent = 'Ø¬Ù„Ø³Ø© Ù…Ø­ÙÙˆØ¸Ø© Ù„Ù„Ø¯ÙˆØ±: ' + roleLabel + ' â€¢ ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø© Ù…Ø¨Ø§Ø´Ø±Ø©.';
  box.style.display = 'flex';
}

function continueSession() {
  var session = SmartClinicSecurity.getSession();
  if (!session) {
    window.alert('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¬Ù„Ø³Ø© Ù…Ø­ÙÙˆØ¸Ø©.');
    return;
  }
  window.location.href = SmartClinicSecurity.getRoleHomePath(session.role);
}

function openCareCenter() {
  var session = SmartClinicSecurity.getSession();
  if (!session) {
    window.alert('Ø³Ø¬Ù‘Ù„ Ø¯Ø®ÙˆÙ„Ùƒ Ø£ÙˆÙ„Ù‹Ø§ Ø«Ù… Ø§ÙØªØ­ Ù…Ø±ÙƒØ² Ø§Ù„ØªÙ†Ø³ÙŠÙ‚.');
    return;
  }
  window.location.href = 'src/pages/care-center.html';
}

async function updateApiStatus() {
  try {
    var result = await SmartClinicSecurity.apiJson('/health', { skipAuthRedirect: true });
    if (!result.ok) throw new Error('health_error');
    var mode = result.data && result.data.mode === 'demo' ? ' (Demo)' : '';
    document.getElementById('api-status').textContent = 'Ø§Ù„Ù†Ø¸Ø§Ù… ÙŠØ¹Ù…Ù„ Ø§Ù„Ø¢Ù†';
    if (mode) {
      document.getElementById('api-status').textContent += mode;
    }
    document.getElementById('api-dot').className = 'status';
  } catch (err) {
    document.getElementById('api-status').textContent = 'Ø§Ù„Ø®Ø§Ø¯Ù… ØºÙŠØ± Ù…ØªØµÙ„';
    document.getElementById('api-dot').className = 'status offline';
  }
}

async function openSecureRoute(route, role) {
  var result = await SmartClinicSecurity.login(role);
  if (!result.ok || !SmartClinicSecurity.canAccess(route, role)) {
    window.alert('Ù„Ø§ ÙŠÙ…ÙƒÙ† ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ù‡Ø°Ø§ Ø§Ù„Ø¯ÙˆØ± Ù„Ù‡Ø°Ù‡ Ø§Ù„ØµÙØ­Ø©.');
    return;
  }
  updateRoleBadge();
  window.location.href = route;
}

async function cardKey(event, page, role) {
  if (event.key === 'Enter' || event.key === ' ') {
    event.preventDefault();
    await openSecureRoute(page, role);
  }
}

window.addEventListener('DOMContentLoaded', function () {
  updateRoleBadge();
  SmartClinicSecurity.initFlashNotice();
  updateApiStatus();
  setInterval(updateApiStatus, 15000);
});
</script>
</body>
</html>
