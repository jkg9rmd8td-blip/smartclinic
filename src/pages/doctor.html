<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>Ù„ÙˆØ­Ø© Ø§Ù„Ø·Ø¨ÙŠØ¨ â€“ Smart Clinic</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="../../assets/css/variables.css">
<link rel="stylesheet" href="../../assets/css/layout.css">
<link rel="stylesheet" href="../../assets/css/cards.css">
<link rel="stylesheet" href="../../assets/css/tables.css">
<style>
.doctor-meta {
  display: flex;
  gap: var(--sc-space-2);
  flex-wrap: wrap;
  margin-bottom: var(--sc-space-3);
}

.critical-zone {
  border: 1px solid rgba(255, 77, 79, 0.55);
  background: linear-gradient(125deg, rgba(255, 77, 79, 0.18), rgba(5, 20, 34, 0.75));
}

.critical-row {
  display: flex;
  justify-content: space-between;
  align-items: center;
  gap: var(--sc-space-3);
  flex-wrap: wrap;
}

.critical-title {
  margin: 0 0 6px;
  font-size: var(--sc-h2-size);
  line-height: var(--sc-title-line-height);
  font-weight: var(--sc-h2-weight);
}

.critical-sub {
  margin: 0;
  color: #fecaca;
  font-size: 14px;
}

.active-case-grid {
  display: grid;
  grid-template-columns: repeat(3, minmax(0, 1fr));
  gap: 12px;
  margin-bottom: 12px;
}

.meta-tile {
  border: 1px solid rgba(255, 255, 255, 0.12);
  background: rgba(255, 255, 255, 0.03);
  border-radius: var(--sc-radius-md);
  padding: 10px 12px;
}

.meta-tile-label {
  color: var(--sc-text-soft);
  font-size: 12px;
}

.meta-tile-value {
  margin-top: 4px;
  font-size: 14px;
  font-weight: 700;
}

.action-cluster {
  display: flex;
  gap: var(--sc-space-2);
  flex-wrap: wrap;
  margin-top: 8px;
}

.service-feedback {
  margin-top: 10px;
  border: 1px solid rgba(255, 255, 255, 0.16);
  background: rgba(255, 255, 255, 0.04);
  border-radius: var(--sc-radius-md);
  padding: 8px 10px;
  color: var(--sc-text-soft);
  font-size: 13px;
}

.service-feedback.ok {
  border-color: rgba(82, 196, 26, 0.52);
  color: #bef2a1;
}

.service-feedback.warn {
  border-color: rgba(250, 140, 22, 0.5);
  color: #ffd8aa;
}

.service-feedback.danger {
  border-color: rgba(255, 77, 79, 0.58);
  color: #ffb3b3;
}

.services-grid .sc-panel {
  min-height: 190px;
}

.case-toolbar {
  display: grid;
  grid-template-columns: repeat(3, minmax(0, 1fr));
  gap: 12px;
  margin-bottom: 10px;
}

.cases-inline-actions {
  display: flex;
  gap: 8px;
  flex-wrap: wrap;
}

.ghost-btn {
  border: 1px solid var(--sc-border);
  background: rgba(255, 255, 255, 0.03);
  color: var(--sc-text);
  border-radius: 999px;
  padding: 8px 14px;
  font: inherit;
  font-size: 13px;
  cursor: pointer;
}

.ghost-btn:hover {
  background: rgba(255, 255, 255, 0.12);
}

.sc-table tbody tr.is-active-row {
  background: rgba(56, 189, 248, 0.14);
}

.ai-panel textarea {
  margin-top: 10px;
}

.ai-result {
  margin-top: 10px;
  background: rgba(255, 255, 255, 0.04);
  border: 1px solid rgba(255, 255, 255, 0.12);
  border-radius: var(--sc-radius-md);
  padding: 10px;
  font-size: 14px;
}

.ai-actions {
  margin-top: 10px;
  display: flex;
  flex-direction: column;
  gap: 6px;
}

.ai-action-item {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 8px;
  border-radius: var(--sc-radius-sm);
  background: rgba(255, 255, 255, 0.03);
  border: 1px solid rgba(255, 255, 255, 0.1);
}

.triage-summary {
  margin-top: 10px;
  border: 1px solid rgba(255,255,255,0.14);
  border-radius: var(--sc-radius-md);
  padding: 10px;
  background: rgba(255,255,255,0.02);
}

.triage-chip {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  border-radius: 999px;
  padding: 4px 10px;
  font-size: 12px;
  border: 1px solid rgba(255,255,255,0.2);
}

.triage-chip.immediate {
  border-color: rgba(255,77,79,0.7);
  color: #ff9ea0;
  background: rgba(255,77,79,0.16);
}

.triage-chip.follow_up {
  border-color: rgba(250,140,22,0.7);
  color: #fdc47e;
  background: rgba(250,140,22,0.16);
}

.triage-chip.simple {
  border-color: rgba(82,196,26,0.7);
  color: #b4ef91;
  background: rgba(82,196,26,0.16);
}

.toast {
  position: fixed;
  left: 16px;
  bottom: 16px;
  background: var(--sc-surface-strong);
  color: var(--sc-text);
  border: 1px solid var(--sc-border);
  border-radius: var(--sc-radius-md);
  padding: 10px 12px;
  display: none;
  z-index: 40;
}

@media (max-width: 980px) {
  .active-case-grid,
  .case-toolbar {
    grid-template-columns: repeat(2, minmax(0, 1fr));
  }
}

@media (max-width: 780px) {
  .active-case-grid,
  .case-toolbar {
    grid-template-columns: 1fr;
  }
}
</style>
</head>
<body class="sc-page">
<div class="sc-shell">
  <header class="sc-page-header">
    <div class="sc-page-header-main">
      <div class="sc-page-icon">ğŸ©º</div>
      <div>
        <h1 class="sc-page-title">Ù„ÙˆØ­Ø© Ø§Ù„Ø·Ø¨ÙŠØ¨ Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©</h1>
        <p class="sc-page-subtitle">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø­Ø§Ù„Ø§ØªØŒ Ø§Ù„ÙØ±Ø² Ø§Ù„Ø·Ø¨ÙŠ Ø§Ù„Ø°ÙƒÙŠØŒ ÙˆØ§Ù„Ù‚Ø±Ø§Ø±Ø§Øª Ø§Ù„Ø³Ø±ÙŠØ±ÙŠØ© Ù…Ù† ÙˆØ§Ø¬Ù‡Ø© Ø·Ø¨ÙŠØ© Ù…ÙˆØ­Ù‘Ø¯Ø©.</p>
      </div>
    </div>
    <div class="sc-header-actions">
      <span class="sc-role-chip">Ø§Ù„Ø¯ÙˆØ± Ø§Ù„Ø­Ø§Ù„ÙŠ: <strong data-session-role>Ø§Ù„Ø·Ø¨ÙŠØ¨</strong></span>
      <button class="sc-action-btn" data-action="logout">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button>
    </div>
  </header>

  <section class="sc-panel sc-mb-24">
    <h2 class="sc-panel-title">Ù…Ù„Ø®Øµ Ø§Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„Ø·Ø¨ÙŠ</h2>
    <div class="doctor-meta">
      <div class="meta-item">Ø§Ù„ÙˆØ¶Ø¹: <strong>Live/API</strong></div>
      <div class="meta-item">Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«: <strong id="doctor-last-sync">-</strong></div>
      <div class="meta-item">Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ù†Ø´Ø·Ø©: <strong id="doctor-active-id">-</strong></div>
    </div>
    <div class="sc-section-nav">
      <button class="sc-action-btn" onclick="scrollDoctorSection('doctor-emergency')">ØªÙ†Ø¨ÙŠÙ‡ Ø§Ù„Ø·ÙˆØ§Ø±Ø¦</button>
      <button class="sc-action-btn" onclick="scrollDoctorSection('doctor-active')">Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ù†Ø´Ø·Ø©</button>
      <button class="sc-action-btn" onclick="scrollDoctorSection('doctor-services')">Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ø·Ø¨ÙŠØ©</button>
      <button class="sc-action-btn" onclick="scrollDoctorSection('doctor-queue')">Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±</button>
      <button class="sc-action-btn" onclick="scrollDoctorSection('doctor-ai')">Ù…Ø³Ø§Ø¹Ø¯ AI</button>
    </div>
  </section>

  <section class="sc-grid-3 sc-kpi-grid sc-mb-24">
    <article class="sc-kpi-card"><div class="sc-kpi-label">Ø­Ø§Ù„Ø§Øª Ø­Ø±Ø¬Ø©</div><div class="sc-kpi-value" id="stat-critical">0</div></article>
    <article class="sc-kpi-card"><div class="sc-kpi-label">Ø­Ø§Ù„Ø§Øª Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©</div><div class="sc-kpi-value" id="stat-progress">0</div></article>
    <article class="sc-kpi-card"><div class="sc-kpi-label">Ø·Ù„Ø¨Ø§Øª Ø²ÙŠØ§Ø±Ø© Ù…Ø¹Ù„Ù‚Ø©</div><div class="sc-kpi-value" id="stat-pending">0</div></article>
    <article class="sc-kpi-card"><div class="sc-kpi-label">Ù†Ø´Ø§Ø· Ø§Ù„ÙŠÙˆÙ…</div><div class="sc-kpi-value" id="stat-actions">0</div></article>
  </section>

  <section id="doctor-emergency" class="sc-panel critical-zone sc-mb-24">
    <div class="critical-row">
      <div>
        <p class="critical-title">ØªÙ†Ø¨ÙŠÙ‡ Ø·Ø¨ÙŠ Ø¹Ø§Ù„ÙŠ Ø§Ù„Ø®Ø·ÙˆØ±Ø©</p>
        <p class="critical-sub" id="critical-sub">Ø¬Ø§Ø±ÙŠ ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø­Ø§Ù„Ø§Øª Ø§Ù„Ø­Ø±Ø¬Ø©...</p>
      </div>
      <button class="btn-danger" id="critical-open" onclick="openCriticalCase()">ÙØªØ­ Ù…Ø³Ø§Ø± Ø§Ù„Ø·ÙˆØ§Ø±Ø¦</button>
    </div>
  </section>

  <section id="doctor-active" class="sc-panel sc-mb-24">
    <h2 class="sc-panel-title">Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ù†Ø´Ø·Ø©</h2>
    <p class="sc-panel-subtitle">Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„Ø³Ø±ÙŠØ¹Ø© Ø³ÙŠØªÙ… ØªØ·Ø¨ÙŠÙ‚Ù‡Ø§ Ø¹Ù„Ù‰ Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø®ØªØ§Ø±Ø©.</p>
    <div class="active-case-grid">
      <div class="meta-tile"><div class="meta-tile-label">Ø§Ù„Ø·Ø§Ù„Ø¨</div><div class="meta-tile-value" id="active-student">-</div></div>
      <div class="meta-tile"><div class="meta-tile-label">Ù…Ø¹Ø±Ù Ø§Ù„Ø·Ø§Ù„Ø¨</div><div class="meta-tile-value" id="active-student-id">-</div></div>
      <div class="meta-tile"><div class="meta-tile-label">Ø§Ù„Ø­Ø§Ù„Ø©</div><div class="meta-tile-value" id="active-title">-</div></div>
      <div class="meta-tile"><div class="meta-tile-label">Ù…Ø¹Ø±Ù Ø§Ù„Ø­Ø§Ù„Ø©</div><div class="meta-tile-value" id="active-case-id">-</div></div>
      <div class="meta-tile"><div class="meta-tile-label">Ø§Ù„Ø®Ø·ÙˆØ±Ø©</div><div class="meta-tile-value" id="active-severity">-</div></div>
      <div class="meta-tile"><div class="meta-tile-label">Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«</div><div class="meta-tile-value" id="active-updated">-</div></div>
    </div>
    <div class="action-cluster">
      <button class="btn-primary" onclick="openCase(activeCaseId)">ÙØªØ­ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø­Ø§Ù„Ø©</button>
      <button class="btn-danger" onclick="openCriticalCase()">ÙØªØ­ Ø§Ù„Ø·ÙˆØ§Ø±Ø¦</button>
      <button class="btn-warning" data-permission="update.vitals" onclick="generateActiveCaseVitals()">ØªÙˆÙ„ÙŠØ¯ Ù‚Ø±Ø§Ø¡Ø© Ø­ÙŠÙˆÙŠØ©</button>
      <button class="btn-success" data-permission="start.telemed" onclick="startTelemedSession()">Ø¨Ø¯Ø¡ Ø¬Ù„Ø³Ø© Ù…Ø±Ø¦ÙŠØ©</button>
    </div>
    <div id="service-feedback" class="service-feedback">Ø¢Ø®Ø± Ø¥Ø¬Ø±Ø§Ø¡: Ø§Ø®ØªØ± Ø­Ø§Ù„Ø© Ø«Ù… Ù†ÙÙ‘Ø° Ø®Ø¯Ù…Ø© Ø·Ø¨ÙŠØ©.</div>
  </section>

  <h2 id="doctor-services" class="sc-section-title">Ø§Ù„Ø®Ø¯Ù…Ø§Øª ÙˆØ§Ù„Ù…ÙŠØ²Ø§Øª Ø§Ù„Ø·Ø¨ÙŠØ©</h2>
  <section class="sc-grid-3 services-grid sc-mb-24">
    <article class="sc-panel" data-permission="view.student">
      <h3 class="sc-panel-title">Ù…Ù„Ù Ø§Ù„Ø·Ø§Ù„Ø¨ Ø§Ù„Ù…ÙˆØ­Ø¯</h3>
      <p class="sc-panel-subtitle">Ø§Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…Ø±Ø¶ÙŠ ÙˆØ§Ù„Ø­Ø³Ø§Ø³ÙŠØ© ÙˆØ§Ù„Ø²ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø³Ø§Ø¨Ù‚Ø© Ø¨Ø´ÙƒÙ„ ÙÙˆØ±ÙŠ.</p>
      <button class="btn-primary" onclick="openActiveStudentProfile()">ÙØªØ­ Ø§Ù„Ù…Ù„Ù</button>
    </article>
    <article class="sc-panel" data-permission="prescribe.medication">
      <h3 class="sc-panel-title">Ø§Ù„ÙˆØµÙØ© Ø§Ù„Ø¯ÙˆØ§Ø¦ÙŠØ©</h3>
      <p class="sc-panel-subtitle">Ø¥ØµØ¯Ø§Ø± ÙˆØµÙØ© Ù…Ø¹ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­Ø¯Ø« Ù…Ø¨Ø§Ø´Ø±Ø© ÙÙŠ Ø³Ø¬Ù„ Ø§Ù„Ø­Ø§Ù„Ø©.</p>
      <button class="btn-success" onclick="issuePrescription()">Ø¥ØµØ¯Ø§Ø± ÙˆØµÙØ©</button>
    </article>
    <article class="sc-panel" data-permission="order.labs">
      <h3 class="sc-panel-title">Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ø®ØªØ¨Ø±</h3>
      <p class="sc-panel-subtitle">Ø·Ù„Ø¨ ÙØ­ÙˆØµØ§Øª Ù…Ø®Ø¨Ø±ÙŠØ© Ø¹Ø§Ø¬Ù„Ø© Ø£Ùˆ Ø¯ÙˆØ±ÙŠØ© Ù…Ø¹ ØªÙˆØ«ÙŠÙ‚ Ø§Ù„Ù‚Ø±Ø§Ø±.</p>
      <button class="btn-primary" onclick="createLabOrderTicket()">Ø·Ù„Ø¨ ÙØ­Øµ</button>
    </article>
    <article class="sc-panel" data-permission="approve.referral">
      <h3 class="sc-panel-title">Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ù„Ù„Ù…Ø³ØªØ´ÙÙ‰</h3>
      <p class="sc-panel-subtitle">Ø§Ø¹ØªÙ…Ø§Ø¯ ØªØ­ÙˆÙŠÙ„ Ø±Ø³Ù…ÙŠ Ù„Ù„Ø­Ø§Ù„Ø§Øª Ø§Ù„ØªÙŠ ØªØªØ·Ù„Ø¨ Ø±Ø¹Ø§ÙŠØ© Ø£Ø¹Ù„Ù‰.</p>
      <button class="btn-warning" onclick="issueReferralWorkflow()">Ø§Ø¹ØªÙ…Ø§Ø¯ Ø§Ù„ØªØ­ÙˆÙŠÙ„</button>
    </article>
    <article class="sc-panel" data-permission="start.telemed">
      <h3 class="sc-panel-title">Ø§Ø³ØªØ´Ø§Ø±Ø© Ø·Ø¨ÙŠØ© Ø¹Ù† Ø¨Ø¹Ø¯</h3>
      <p class="sc-panel-subtitle">ØªÙØ¹ÙŠÙ„ Ø¬Ù„Ø³Ø© Ø§Ø³ØªØ´Ø§Ø±ÙŠØ© ÙˆØ±Ø¨Ø·Ù‡Ø§ Ù…Ø¨Ø§Ø´Ø±Ø© Ø¨Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©.</p>
      <button class="btn-primary" onclick="startTelemedSession()">Ø¨Ø¯Ø¡ Ø¬Ù„Ø³Ø©</button>
    </article>
    <article class="sc-panel" data-permission="view.doctor">
      <h3 class="sc-panel-title">Ù…Ø±ÙƒØ² Ø§Ù„ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø¹Ù„Ø§Ø¬ÙŠ</h3>
      <p class="sc-panel-subtitle">Ù…ÙˆØ§ÙÙ‚Ø§Øª ÙˆÙ„ÙŠ Ø§Ù„Ø£Ù…Ø±ØŒ Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ØŒ Ø§Ù„ØªØ°Ø§ÙƒØ±ØŒ Ø§Ù„Ø¥Ø­Ø§Ù„Ø§ØªØŒ ÙˆØ§Ù„Ø§Ù„ØªØ²Ø§Ù… Ø§Ù„Ø¯ÙˆØ§Ø¦ÙŠ.</p>
      <button class="btn-primary" onclick="go('care-center.html')">ÙØªØ­ Ø§Ù„Ù…Ø±ÙƒØ²</button>
    </article>
    <article class="sc-panel" data-permission="view.analytics">
      <h3 class="sc-panel-title">ØªØ­Ù„ÙŠÙ„Ø§Øª Ø³Ø±ÙŠØ±ÙŠØ©</h3>
      <p class="sc-panel-subtitle">Ø¹Ø±Ø¶ Ù…Ø¤Ø´Ø±Ø§Øª Ø­ÙŠØ© Ù„Ù„Ø£Ø¯Ø§Ø¡ Ø§Ù„Ø·Ø¨ÙŠ ÙˆØ§Ù„ØªØ´ØºÙŠÙ„ÙŠ.</p>
      <button class="btn-primary" onclick="go('admin-analytics.html')">Ø¹Ø±Ø¶ Ø§Ù„ØªØ­Ù„ÙŠÙ„Ø§Øª</button>
    </article>
    <article class="sc-panel" data-permission="view.notifications">
      <h3 class="sc-panel-title">Ù…Ø±ÙƒØ² Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª</h3>
      <p class="sc-panel-subtitle">Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ù…ÙˆØ­Ø¯Ø© Ù„Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ø·Ø¨ÙŠ Ù…Ø¹ ÙÙ„ØªØ±Ø© Ø³Ø±ÙŠØ¹Ø© Ø­Ø³Ø¨ Ø§Ù„Ù†ÙˆØ¹.</p>
      <button class="btn-primary" onclick="go('notifications-center.html')">ÙØªØ­ Ø§Ù„Ù…Ø±ÙƒØ²</button>
    </article>
  </section>

  <section id="doctor-queue" class="sc-grid-3 sc-mb-24">
    <article class="sc-panel sc-col-span-2">
      <h2 class="sc-panel-title">Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±</h2>
      <div class="case-toolbar">
        <input id="case-search" class="input" type="search" placeholder="Ø¨Ø­Ø« Ø¨Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨ Ø£Ùˆ Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø­Ø§Ù„Ø©..." oninput="applyCaseFilters()">
        <select id="case-severity-filter" class="input" onchange="applyCaseFilters()">
          <option value="all">ÙƒÙ„ Ø¯Ø±Ø¬Ø§Øª Ø§Ù„Ø®Ø·ÙˆØ±Ø©</option>
          <option value="critical">Ø­Ø±Ø¬Ø©</option>
          <option value="high">Ø¹Ø§Ù„ÙŠØ©</option>
          <option value="medium">Ù…ØªÙˆØ³Ø·Ø©</option>
          <option value="low">Ù…Ù†Ø®ÙØ¶Ø©</option>
        </select>
        <select id="case-status-filter" class="input" onchange="applyCaseFilters()">
          <option value="all">ÙƒÙ„ Ø§Ù„Ø­Ø§Ù„Ø§Øª</option>
          <option value="in_progress">Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©</option>
          <option value="open">Ù…ÙØªÙˆØ­Ø©</option>
        </select>
      </div>
      <div class="sc-muted sc-mb-16">Ø¹Ø¯Ø¯ Ø§Ù„Ø­Ø§Ù„Ø§Øª Ø§Ù„Ù…Ø¹Ø±ÙˆØ¶Ø©: <strong id="cases-count">0</strong></div>
      <div class="sc-table-wrap">
        <table class="sc-table">
          <thead>
            <tr>
              <th>Ø§Ù„Ø·Ø§Ù„Ø¨</th>
              <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
              <th>Ø§Ù„Ø®Ø·ÙˆØ±Ø©</th>
              <th>Ø§Ù„ÙˆÙ‚Øª</th>
              <th>Ø¥Ø¬Ø±Ø§Ø¡</th>
            </tr>
          </thead>
          <tbody id="queue-list">
            <tr><td colspan="5" class="sc-table-empty">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø­Ø§Ù„Ø§Øª ÙÙŠ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±</td></tr>
          </tbody>
        </table>
      </div>
    </article>

    <article class="sc-panel">
      <h2 class="sc-panel-title">Ø§Ù„Ø­Ø§Ù„Ø§Øª Ø§Ù„Ù…ÙØªÙˆØ­Ø©</h2>
      <div class="sc-table-wrap sc-mb-16">
        <table class="sc-table">
          <thead>
            <tr>
              <th>Ø§Ù„Ø·Ø§Ù„Ø¨</th>
              <th>Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø­Ø§Ù„Ø©</th>
              <th>Ø§Ù„Ø®Ø·ÙˆØ±Ø©</th>
              <th>Ø¥Ø¬Ø±Ø§Ø¡</th>
            </tr>
          </thead>
          <tbody id="cases-grid">
            <tr><td colspan="4" class="sc-table-empty">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø­Ø§Ù„Ø§Øª Ù…ÙØªÙˆØ­Ø©</td></tr>
          </tbody>
        </table>
      </div>

      <h3 class="sc-panel-title">Ø¢Ø®Ø± Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª</h3>
      <div class="sc-table-wrap">
        <table class="sc-table">
          <thead>
            <tr>
              <th>Ø§Ù„ÙˆÙ‚Øª</th>
              <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡</th>
            </tr>
          </thead>
          <tbody id="mini-log">
            <tr><td colspan="2" class="sc-table-empty">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¹Ù…Ù„ÙŠØ§Øª Ø­Ø¯ÙŠØ«Ø©.</td></tr>
          </tbody>
        </table>
      </div>
    </article>
  </section>

  <section id="doctor-ai" class="sc-panel ai-panel" data-permission="use.ai.assistant">
    <h2 class="sc-panel-title">Ù…Ø³Ø§Ø¹Ø¯ Ø§Ù„Ù‚Ø±Ø§Ø± Ø§Ù„Ø·Ø¨ÙŠ AI</h2>
    <p class="sc-panel-subtitle">ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ù†Ø´Ø·Ø© Ù…Ø¹ ÙØ±Ø² Ø·Ø¨ÙŠ Ø°ÙƒÙŠ (Ø§Ù„Ø¹Ù„Ø§Ù…Ø§Øª Ø§Ù„Ø­ÙŠÙˆÙŠØ© + Ø§Ù„Ø´ÙƒÙˆÙ‰ + Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„ØµØ­ÙŠ) ÙˆØªÙˆØµÙŠØ© Ø£ÙˆÙ„ÙŠØ© Ø¨Ø§Ù„Ø¨Ø±ÙˆØªÙˆÙƒÙˆÙ„.</p>
    <textarea id="ai-doctor-complaint" rows="2" placeholder="Ø§Ù„Ø´ÙƒÙˆÙ‰ Ø§Ù„Ø­Ø§Ù„ÙŠØ© (Ù…Ø«Ø§Ù„: Ø¶ÙŠÙ‚ ØªÙ†ÙØ³ + Ø£Ù„Ù… ØµØ¯Ø±)"></textarea>
    <textarea id="ai-doctor-note" rows="3" placeholder="Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø³Ø±ÙŠØ±ÙŠØ© Ø¥Ø¶Ø§ÙÙŠØ© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)"></textarea>
    <div class="inline-row" style="margin-top:10px;">
      <button class="btn-primary" onclick="runDoctorAi()">ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©</button>
      <button class="btn-muted" onclick="document.getElementById('ai-doctor-note').value='';document.getElementById('ai-doctor-complaint').value=''">Ù…Ø³Ø­ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„</button>
    </div>
    <div id="ai-doctor-result" class="ai-result">Ù„Ù… ÙŠØªÙ… ØªØ´ØºÙŠÙ„ Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø¨Ø¹Ø¯.</div>
  </section>
</div>

<div id="toast" class="toast"></div>
<script src="../../assets/js/security.js"></script>
<script src="../../assets/js/ui-shell.js"></script>
<script>
var allCasesCache = [];
var casesCache = [];
var activeCaseId = 'case_1';
var latestDoctorAi = null;
var ACTIVE_CASE_STORAGE_KEY = 'smartclinic.doctor.activeCase.v1';

function actionLabel(type) {
  var labels = {
    emergency_protocol: 'ØªÙØ¹ÙŠÙ„ Ø¨Ø±ÙˆØªÙˆÙƒÙˆÙ„ Ø§Ù„Ø·ÙˆØ§Ø±Ø¦',
    external_referral: 'ØªØ­ÙˆÙŠÙ„ Ø®Ø§Ø±Ø¬ÙŠ',
    vitals_update: 'ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ù„Ø§Ù…Ø§Øª Ø§Ù„Ø­ÙŠÙˆÙŠØ©',
    careplan_save: 'Ø­ÙØ¸ Ø®Ø·Ø© Ø§Ù„Ø±Ø¹Ø§ÙŠØ©',
    prescription: 'Ø¥ØµØ¯Ø§Ø± ÙˆØµÙØ© Ø¯ÙˆØ§Ø¦ÙŠØ©',
    lab_order: 'Ø·Ù„Ø¨ ÙØ­Øµ Ù…Ø®Ø¨Ø±ÙŠ'
  };
  return labels[type] || type;
}

function go(path) {
  window.location.href = path;
}

function notify(text) {
  var toast = document.getElementById('toast');
  toast.textContent = text;
  toast.style.display = 'block';
  window.setTimeout(function () {
    toast.style.display = 'none';
  }, 2200);
}

function scrollDoctorSection(id) {
  var target = document.getElementById(id);
  if (target) {
    target.scrollIntoView({ behavior: 'smooth', block: 'start' });
  }
}

function formatCaseLine(item) {
  return (item.title || 'Ø­Ø§Ù„Ø© Ø¹Ø§Ù…Ø©') + ' â€¢ ' + (item.status || '-') + ' â€¢ ' + (item.severity || '-');
}

function severityPillClass(severity) {
  if (severity === 'critical' || severity === 'high') return 'sc-severity-critical';
  if (severity === 'medium') return 'sc-severity-medium';
  return 'sc-severity-low';
}

function formatWhen(iso) {
  if (!iso) return '-';
  return new Date(iso).toLocaleString('ar-SA');
}

function getActiveCase() {
  return allCasesCache.find(function (item) { return item.id === activeCaseId; }) || null;
}

function saveActiveCaseId(caseId) {
  try {
    localStorage.setItem(ACTIVE_CASE_STORAGE_KEY, String(caseId || ''));
  } catch (err) {
    // Ignore storage errors in restricted environments.
  }
}

function readActiveCaseId() {
  try {
    return String(localStorage.getItem(ACTIVE_CASE_STORAGE_KEY) || '').trim();
  } catch (err) {
    return '';
  }
}

function hasCase(caseId) {
  if (!caseId) return false;
  return allCasesCache.some(function (item) { return item.id === caseId; });
}

function getActiveStudentId() {
  var item = getActiveCase();
  return item && item.studentId ? item.studentId : 'u_student_1';
}

function setServiceFeedback(text, level) {
  var wrap = document.getElementById('service-feedback');
  if (!wrap) return;
  var safeLevel = (level === 'ok' || level === 'warn' || level === 'danger') ? level : '';
  wrap.className = 'service-feedback' + (safeLevel ? (' ' + safeLevel) : '');
  wrap.textContent = 'Ø¢Ø®Ø± Ø¥Ø¬Ø±Ø§Ø¡: ' + (text || 'Ù„Ø§ ÙŠÙˆØ¬Ø¯.');
}

async function downloadBlobFromApi(path, filename) {
  var response = await SmartClinicSecurity.apiRequest(path);
  if (!response.ok) {
    return false;
  }
  var blob = await response.blob();
  var url = URL.createObjectURL(blob);
  var link = document.createElement('a');
  link.href = url;
  link.download = filename;
  document.body.appendChild(link);
  link.click();
  link.remove();
  URL.revokeObjectURL(url);
  return true;
}

function renderActiveCaseSummary() {
  var item = getActiveCase();
  document.getElementById('active-student').textContent = item ? (item.studentName || '-') : '-';
  document.getElementById('active-student-id').textContent = item ? (item.studentId || '-') : '-';
  document.getElementById('active-title').textContent = item ? (item.title || '-') : '-';
  document.getElementById('active-case-id').textContent = item ? (item.id || '-') : '-';
  document.getElementById('active-severity').textContent = item ? (item.severity || '-') : '-';
  document.getElementById('active-updated').textContent = item ? formatWhen(item.updatedAt) : '-';
  document.getElementById('doctor-active-id').textContent = item ? (item.id || '-') : '-';
  if (!item) {
    setServiceFeedback('Ø§Ø®ØªØ± Ø­Ø§Ù„Ø© Ù…Ù† Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± Ù„ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ø·Ø¨ÙŠØ©.', 'warn');
  }
}

function selectCase(caseId) {
  if (!caseId) return;
  activeCaseId = caseId;
  saveActiveCaseId(caseId);
  renderCritical(casesCache);
  renderCases(casesCache);
  renderActiveCaseSummary();
}

function renderCases(items) {
  var queue = document.getElementById('queue-list');
  var grid = document.getElementById('cases-grid');
  document.getElementById('cases-count').textContent = String(items.length);
  if (!items.length) {
    queue.innerHTML = '<tr><td colspan="5" class="sc-table-empty">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø­Ø§Ù„Ø§Øª ÙÙŠ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±</td></tr>';
    grid.innerHTML = '<tr><td colspan="4" class="sc-table-empty">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø­Ø§Ù„Ø§Øª Ù…ÙØªÙˆØ­Ø©</td></tr>';
    return;
  }

  queue.innerHTML = items.map(function (item) {
    var active = item.id === activeCaseId ? ' class="is-active-row"' : '';
    var when = formatWhen(item.updatedAt);
    return '<tr' + active + '>' +
      '<td>' + (item.studentName || '-') + '</td>' +
      '<td>' + formatCaseLine(item) + '</td>' +
      '<td><span class="sc-badge ' + severityPillClass(item.severity) + '">' + (item.severity || 'low') + '</span></td>' +
      '<td>' + when + '</td>' +
      '<td><div class="cases-inline-actions"><button class="btn-muted" type="button" onclick="selectCase(\'' + item.id + '\')">Ø§Ø®ØªÙŠØ§Ø±</button><button class="btn-primary" type="button" onclick="openCase(\'' + item.id + '\')">ÙØªØ­</button></div></td>' +
    '</tr>';
  }).join('');

  grid.innerHTML = items.map(function (item) {
    var active = item.id === activeCaseId ? ' class="is-active-row"' : '';
    return '<tr' + active + '>' +
      '<td>' + (item.studentName || '-') + '</td>' +
      '<td>' + (item.title || '-') + '</td>' +
      '<td><span class="sc-badge ' + severityPillClass(item.severity) + '">' + (item.severity || 'low') + '</span></td>' +
      '<td><div class="cases-inline-actions"><button class="btn-muted" type="button" onclick="selectCase(\'' + item.id + '\')">ØªØ­Ø¯ÙŠØ¯</button><button class="btn-success" type="button" onclick="openCase(\'' + item.id + '\')">Ø§Ø³ØªÙƒÙ…Ø§Ù„</button></div></td>' +
    '</tr>';
  }).join('');
}

function applyCaseFilters() {
  var query = String((document.getElementById('case-search') || {}).value || '').trim().toLowerCase();
  var severity = String((document.getElementById('case-severity-filter') || {}).value || 'all');
  var status = String((document.getElementById('case-status-filter') || {}).value || 'all');
  var filtered = allCasesCache.filter(function (item) {
    var matchQuery = !query || String(item.studentName || '').toLowerCase().indexOf(query) !== -1 || String(item.title || '').toLowerCase().indexOf(query) !== -1;
    var matchSeverity = severity === 'all' || item.severity === severity;
    var matchStatus = status === 'all' || item.status === status;
    return matchQuery && matchSeverity && matchStatus;
  });
  casesCache = filtered;
  if (filtered.length && !filtered.some(function (c) { return c.id === activeCaseId; })) {
    var saved = readActiveCaseId();
    activeCaseId = filtered.some(function (c) { return c.id === saved; }) ? saved : filtered[0].id;
  }
  if (!filtered.length) {
    activeCaseId = '';
  }
  if (activeCaseId) {
    saveActiveCaseId(activeCaseId);
  }
  renderCritical(filtered);
  renderCases(filtered);
  renderActiveCaseSummary();
}

function renderStats(overview) {
  var dist = (overview.distributions && overview.distributions.statusCounts) || {};
  var severity = (overview.distributions && overview.distributions.severityCounts) || {};
  document.getElementById('stat-critical').textContent = Number(severity.critical || 0);
  document.getElementById('stat-progress').textContent = Number(dist.in_progress || 0) + Number(dist.open || 0);
  document.getElementById('stat-pending').textContent = Number((overview.snapshot || {}).pendingVisitRequests || 0);
  document.getElementById('stat-actions').textContent = Number((overview.today || {}).actions || 0);
}

function renderCritical(items) {
  var criticalBtn = document.getElementById('critical-open');
  if (!items.length) {
    activeCaseId = '';
    document.getElementById('critical-sub').textContent = 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ø­Ø§Ù„Ø§Øª Ù†Ø´Ø·Ø© Ø­Ø§Ù„ÙŠÙ‹Ø§.';
    criticalBtn.disabled = true;
    return;
  }
  var critical = items.find(function (item) { return item.severity === 'critical'; });
  if (!critical) {
    document.getElementById('critical-sub').textContent = 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ø­Ø§Ù„Ø§Øª Ø­Ø±Ø¬Ø© Ù†Ø´Ø·Ø© Ø­Ø§Ù„ÙŠÙ‹Ø§.';
    if (!items.some(function (item) { return item.id === activeCaseId; })) {
      activeCaseId = items[0].id;
    }
    criticalBtn.disabled = false;
    return;
  }
  if (!activeCaseId || !items.some(function (item) { return item.id === activeCaseId; })) {
    activeCaseId = critical.id;
  }
  document.getElementById('critical-sub').textContent = 'Ø§Ù„Ø·Ø§Ù„Ø¨: ' + critical.studentName + ' | ' + critical.title + ' | ÙŠÙ„Ø²Ù… ØªØ¯Ø®Ù„ Ø³Ø±ÙŠØ¹';
  criticalBtn.disabled = false;
}

function renderMiniLog(logs) {
  var wrap = document.getElementById('mini-log');
  if (!logs || !logs.length) {
    wrap.innerHTML = '<tr><td colspan="2" class="sc-table-empty">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¹Ù…Ù„ÙŠØ§Øª Ø­Ø¯ÙŠØ«Ø©.</td></tr>';
    return;
  }
  wrap.innerHTML = logs.slice(0, 5).map(function (item) {
    var when = item.createdAt ? new Date(item.createdAt).toLocaleTimeString('ar-SA') : '-';
    return '<tr><td>' + when + '</td><td>' + (item.action || '-') + '</td></tr>';
  }).join('');
}

async function loadDoctorData() {
  var summary = await SmartClinicSecurity.apiJson('/analytics/overview');
  if (!summary.ok || !summary.data) {
    notify('ØªØ¹Ø°Ø± ØªØ­Ù…ÙŠÙ„ Ù…Ø¤Ø´Ø±Ø§Øª Ø§Ù„ØªØ­Ù„ÙŠÙ„.');
    return;
  }
  var casesResult = await SmartClinicSecurity.apiJson('/cases');
  if (!casesResult.ok || !casesResult.data) {
    notify('ØªØ¹Ø°Ø± ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø­Ø§Ù„Ø§Øª.');
    return;
  }

  allCasesCache = (casesResult.data.items || []).filter(function (item) {
    return item.status !== 'closed';
  });
  var savedCaseId = readActiveCaseId();
  if (hasCase(savedCaseId)) {
    activeCaseId = savedCaseId;
  } else if (!hasCase(activeCaseId) && allCasesCache.length) {
    activeCaseId = allCasesCache[0].id;
  }
  renderStats(summary.data);
  renderMiniLog(summary.data.recentLogs || []);
  applyCaseFilters();
  document.getElementById('doctor-last-sync').textContent = new Date().toLocaleTimeString('ar-SA');
}

function openCase(caseId) {
  var target = caseId || activeCaseId;
  if (!target) {
    notify('Ø§Ø®ØªØ± Ø­Ø§Ù„Ø© Ø£ÙˆÙ„Ù‹Ø§.');
    return;
  }
  window.location.href = 'case-details.html?id=' + encodeURIComponent(target);
}

function openCriticalCase() {
  if (!activeCaseId) {
    notify('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø­Ø§Ù„Ø© Ù†Ø´Ø·Ø© Ø­Ø§Ù„ÙŠÙ‹Ø§.');
    return;
  }
  window.location.href = 'emergency-flow.html?id=' + encodeURIComponent(activeCaseId);
}

function openActiveStudentProfile() {
  var target = getActiveCase();
  if (!target) {
    notify('Ø§Ø®ØªØ± Ø­Ø§Ù„Ø© Ø£ÙˆÙ„Ù‹Ø§ Ù„ÙØªØ­ Ù…Ù„Ù Ø§Ù„Ø·Ø§Ù„Ø¨ Ø§Ù„Ù…ÙˆØ­Ø¯.');
    return;
  }
  var path = 'student-profile.html?studentId=' + encodeURIComponent(getActiveStudentId()) + '&caseId=' + encodeURIComponent(target.id);
  window.location.href = path;
}

async function generateActiveCaseVitals() {
  var target = getActiveCase();
  if (!target) {
    notify('Ø§Ø®ØªØ± Ø­Ø§Ù„Ø© Ø£ÙˆÙ„Ù‹Ø§ Ù„ØªÙˆÙ„ÙŠØ¯ Ù‚Ø±Ø§Ø¡Ø© Ø­ÙŠÙˆÙŠØ©.');
    return;
  }
  var result = await SmartClinicSecurity.apiJson('/vitals/generate', {
    method: 'POST',
    body: JSON.stringify({
      studentId: target.studentId || 'u_student_1',
      profile: target.severity === 'critical' ? 'watch' : 'normal'
    })
  });
  if (!result.ok || !result.data || !result.data.item) {
    notify(result.error || 'ØªØ¹Ø°Ø± ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ø­ÙŠÙˆÙŠØ©.');
    return;
  }
  var v = result.data.item;
  notify('ØªÙ… ØªÙˆÙ„ÙŠØ¯ Ù‚Ø±Ø§Ø¡Ø©: SpO2 ' + v.spo2 + '% â€¢ HR ' + v.hr + ' bpm');
  await recordCaseAction('vitals_update', 'ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ù„Ø§Ù…Ø§Øª Ø§Ù„Ø­ÙŠÙˆÙŠØ© Ù„Ù„Ø­Ø§Ù„Ø©');
  setServiceFeedback('ØªÙ… ØªÙˆÙ„ÙŠØ¯ Ù‚Ø±Ø§Ø¡Ø© Ø­ÙŠÙˆÙŠØ© ÙˆØ±Ø¨Ø·Ù‡Ø§ Ø¨Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ù†Ø´Ø·Ø©.', 'ok');
}

async function startTelemedSession() {
  var target = getActiveCase();
  if (!target) {
    notify('Ø§Ø®ØªØ± Ø­Ø§Ù„Ø© Ø£ÙˆÙ„Ù‹Ø§ Ù‚Ø¨Ù„ Ø¨Ø¯Ø¡ Ø§Ù„Ø¬Ù„Ø³Ø©.');
    return;
  }
  var allowGuardian = window.confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø§Ù„Ø³Ù…Ø§Ø­ Ù„ÙˆÙ„ÙŠ Ø§Ù„Ø£Ù…Ø± Ø¨Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù… Ù„Ù‡Ø°Ù‡ Ø§Ù„Ø¬Ù„Ø³Ø©ØŸ');
  var telemed = await SmartClinicSecurity.createTelemedSession({
    caseId: target.id,
    studentId: target.studentId || 'u_student_1',
    allowGuardian: allowGuardian,
    title: 'Ø¬Ù„Ø³Ø© Ø·Ø¨ÙŠØ© Ù…Ø¨Ø§Ø´Ø±Ø© Ù„Ù„Ø­Ø§Ù„Ø© ' + target.id
  });

  if (!telemed.ok || !telemed.item) {
    notify('ØªØ¹Ø°Ø± Ø¥Ù†Ø´Ø§Ø¡ Ø¬Ù„Ø³Ø© Ø§Ù„Ø¹ÙŠØ§Ø¯Ø© Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©.');
    return;
  }

  await SmartClinicSecurity.apiJson('/cases/' + encodeURIComponent(target.id) + '/actions', {
    method: 'POST',
    body: JSON.stringify({
      type: 'telemed',
      note: allowGuardian
        ? 'ØªÙ… Ø¨Ø¯Ø¡ Ø¬Ù„Ø³Ø© Ø§Ø³ØªØ´Ø§Ø±Ø© Ø¹Ù† Ø¨Ø¹Ø¯ Ù…Ø¹ Ø¥ØªØ§Ø­Ø© Ù…Ø´Ø§Ø±ÙƒØ© ÙˆÙ„ÙŠ Ø§Ù„Ø£Ù…Ø±'
        : 'ØªÙ… Ø¨Ø¯Ø¡ Ø¬Ù„Ø³Ø© Ø§Ø³ØªØ´Ø§Ø±Ø© Ø¹Ù† Ø¨Ø¹Ø¯'
    })
  });

  notify('ØªÙ… ØªØ¬Ù‡ÙŠØ² Ø§Ù„Ø¬Ù„Ø³Ø© Ø§Ù„Ù…Ø±Ø¦ÙŠØ©ØŒ Ø¬Ø§Ø±Ù Ø§Ù„ØªØ­ÙˆÙŠÙ„...');
  setServiceFeedback('ØªÙ… ØªÙØ¹ÙŠÙ„ Ø¬Ù„Ø³Ø© Ù…Ø±Ø¦ÙŠØ© Ù„Ù„Ø­Ø§Ù„Ø© ' + target.id + '.', 'ok');
  window.setTimeout(function () {
    window.location.href = 'telemed-room.html?sid=' + encodeURIComponent(telemed.item.id);
  }, 450);
}

async function issuePrescription() {
  var target = getActiveCase();
  if (!target) {
    notify('Ø§Ø®ØªØ± Ø­Ø§Ù„Ø© Ø£ÙˆÙ„Ù‹Ø§ Ù‚Ø¨Ù„ Ø¥ØµØ¯Ø§Ø± ÙˆØµÙØ©.');
    return;
  }
  var name = window.prompt('Ø§Ø³Ù… Ø§Ù„Ø¯ÙˆØ§Ø¡:', 'Paracetamol 500mg');
  if (name === null) return;
  name = String(name || '').trim();
  if (!name) {
    notify('Ø§Ø³Ù… Ø§Ù„Ø¯ÙˆØ§Ø¡ Ù…Ø·Ù„ÙˆØ¨.');
    return;
  }
  var dosesInput = window.prompt('Ø¹Ø¯Ø¯ Ø§Ù„Ø¬Ø±Ø¹Ø§Øª Ø§Ù„ÙŠÙˆÙ…ÙŠØ© (1-8):', '2');
  if (dosesInput === null) return;
  var doses = Number(dosesInput);
  if (!Number.isFinite(doses) || doses < 1 || doses > 8) {
    notify('Ø¹Ø¯Ø¯ Ø§Ù„Ø¬Ø±Ø¹Ø§Øª ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ø¨ÙŠÙ† 1 Ùˆ 8.');
    return;
  }
  var instructions = window.prompt('ØªØ¹Ù„ÙŠÙ…Ø§Øª Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…:', 'Ø¨Ø¹Ø¯ Ø§Ù„Ø£ÙƒÙ„ Ù„Ù…Ø¯Ø© 5 Ø£ÙŠØ§Ù…');
  if (instructions === null) return;
  var planResult = await SmartClinicSecurity.apiJson('/medications/plans', {
    method: 'POST',
    body: JSON.stringify({
      studentId: getActiveStudentId(),
      name: name,
      dosesPerDay: Math.round(doses),
      instructions: String(instructions || '').trim()
    })
  });
  if (!planResult.ok || !planResult.data || !planResult.data.item) {
    notify(planResult.error || 'ØªØ¹Ø°Ø± Ø¥ØµØ¯Ø§Ø± Ø§Ù„Ø®Ø·Ø© Ø§Ù„Ø¯ÙˆØ§Ø¦ÙŠØ©.');
    return;
  }
  var note = 'Ø¥ØµØ¯Ø§Ø± ÙˆØµÙØ© Ø¯ÙˆØ§Ø¦ÙŠØ©: ' + name + ' (' + Math.round(doses) + ' Ø¬Ø±Ø¹Ø©/ÙŠÙˆÙ…)';
  await recordCaseAction('prescription', note);
  setServiceFeedback('ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø®Ø·Ø© Ø¯ÙˆØ§Ø¦ÙŠØ© Ù…Ø±ØªØ¨Ø·Ø© Ø¨Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ù†Ø´Ø·Ø©.', 'ok');
}

async function createLabOrderTicket() {
  var target = getActiveCase();
  if (!target) {
    notify('Ø§Ø®ØªØ± Ø­Ø§Ù„Ø© Ø£ÙˆÙ„Ù‹Ø§ Ù‚Ø¨Ù„ Ø·Ù„Ø¨ Ø§Ù„ÙØ­Øµ.');
    return;
  }
  var testName = window.prompt('Ø§Ø³Ù… Ø§Ù„ÙØ­Øµ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨:', 'CBC + CRP');
  if (testName === null) return;
  testName = String(testName || '').trim();
  if (!testName) {
    notify('Ø§Ø³Ù… Ø§Ù„ÙØ­Øµ Ù…Ø·Ù„ÙˆØ¨.');
    return;
  }
  var details = window.prompt('ØªÙØ§ØµÙŠÙ„ Ø¥Ø¶Ø§ÙÙŠØ© Ù„Ù„Ù…Ø®ØªØ¨Ø± (Ø§Ø®ØªÙŠØ§Ø±ÙŠ):', 'ÙØ­Øµ Ø¹Ø§Ø¬Ù„ Ø®Ù„Ø§Ù„ Ø³Ø§Ø¹ØªÙŠÙ†') || '';
  var priority = target.severity === 'critical' ? 'critical' : (target.severity === 'high' ? 'high' : 'normal');
  var ticketResult = await SmartClinicSecurity.apiJson('/tickets', {
    method: 'POST',
    body: JSON.stringify({
      studentId: getActiveStudentId(),
      subject: 'Ø·Ù„Ø¨ ÙØ­Øµ Ù…Ø®Ø¨Ø±ÙŠ: ' + testName,
      text: details || ('ØªÙ… Ø·Ù„Ø¨ ÙØ­Øµ ' + testName + ' Ù„Ù„Ø­Ø§Ù„Ø© ' + target.id),
      priority: priority
    })
  });
  if (!ticketResult.ok || !ticketResult.data || !ticketResult.data.item) {
    notify(ticketResult.error || 'ØªØ¹Ø°Ø± Ø¥Ù†Ø´Ø§Ø¡ ØªØ°ÙƒØ±Ø© ÙØ­Øµ Ù…Ø®Ø¨Ø±ÙŠ.');
    return;
  }
  var ticket = ticketResult.data.item;
  var note = 'ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ ÙØ­Øµ Ù…Ø®Ø¨Ø±ÙŠ: ' + testName + (ticket.number ? ' â€¢ ' + ticket.number : '');
  await recordCaseAction('lab_order', note);
  setServiceFeedback('ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø·Ù„Ø¨ Ø§Ù„ÙØ­Øµ ÙˆØªØ°ÙƒØ±Ø© Ù…ØªØ§Ø¨Ø¹Ø© ' + (ticket.number || ticket.id) + '.', 'warn');
}

async function issueReferralWorkflow() {
  var target = getActiveCase();
  if (!target) {
    notify('Ø§Ø®ØªØ± Ø­Ø§Ù„Ø© Ø£ÙˆÙ„Ù‹Ø§ Ù‚Ø¨Ù„ Ø¥ØµØ¯Ø§Ø± Ø§Ù„ØªØ­ÙˆÙŠÙ„.');
    return;
  }
  var destination = window.prompt('Ø¬Ù‡Ø© Ø§Ù„ØªØ­ÙˆÙŠÙ„:', 'Ù…Ø³ØªØ´ÙÙ‰ Ø§Ù„Ø·ÙˆØ§Ø±Ø¦');
  if (destination === null) return;
  destination = String(destination || '').trim();
  if (!destination) {
    notify('Ø¬Ù‡Ø© Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ù…Ø·Ù„ÙˆØ¨Ø©.');
    return;
  }
  var reason = window.prompt('Ø³Ø¨Ø¨ Ø§Ù„ØªØ­ÙˆÙŠÙ„:', 'Ø­Ø§Ù„Ø© ØªØ³ØªØ¯Ø¹ÙŠ Ø±Ø¹Ø§ÙŠØ© Ø£Ø¹Ù„Ù‰');
  if (reason === null) return;
  reason = String(reason || '').trim();
  if (!reason) {
    notify('Ø³Ø¨Ø¨ Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ù…Ø·Ù„ÙˆØ¨.');
    return;
  }
  var diagnosis = window.prompt('Ø§Ù„ØªØ´Ø®ÙŠØµ Ø§Ù„Ø£ÙˆÙ„ÙŠ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ):', target.title || '') || '';
  var summary = window.prompt('Ø§Ù„Ù…Ù„Ø®Øµ Ø§Ù„Ø³Ø±ÙŠØ±ÙŠ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ):', 'Ø§Ù„Ø­Ø§Ù„Ø© ØªØ­Øª Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø© ÙˆØªØ­ØªØ§Ø¬ ØªÙ‚ÙŠÙŠÙ…Ù‹Ø§ Ù…Ø³ØªØ´ÙÙˆÙŠÙ‹Ø§.') || '';
  var referralResult = await SmartClinicSecurity.apiJson('/referrals', {
    method: 'POST',
    body: JSON.stringify({
      studentId: getActiveStudentId(),
      destination: destination,
      reason: reason,
      diagnosis: String(diagnosis || '').trim(),
      clinicalSummary: String(summary || '').trim()
    })
  });
  if (!referralResult.ok || !referralResult.data || !referralResult.data.item) {
    notify(referralResult.error || 'ØªØ¹Ø°Ø± Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¥Ø­Ø§Ù„Ø©.');
    return;
  }
  var referral = referralResult.data.item;
  await recordCaseAction('external_referral', 'ØªÙ… Ø§Ø¹ØªÙ…Ø§Ø¯ ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø­Ø§Ù„Ø© Ø¥Ù„Ù‰ ' + destination);
  setServiceFeedback('ØªÙ… Ø¥ØµØ¯Ø§Ø± Ø¥Ø­Ø§Ù„Ø© Ø®Ø§Ø±Ø¬ÙŠØ© Ù„Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ù†Ø´Ø·Ø©.', 'danger');

  if (window.confirm('Ø¥Ù†Ø´Ø§Ø¡ Ø·Ù„Ø¨ Ù…ÙˆØ§ÙÙ‚Ø© ÙˆÙ„ÙŠ Ø§Ù„Ø£Ù…Ø± Ø¹Ù„Ù‰ Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø¢Ù†ØŸ')) {
    var consentResult = await SmartClinicSecurity.apiJson('/consents', {
      method: 'POST',
      body: JSON.stringify({
        studentId: getActiveStudentId(),
        type: 'referral',
        title: 'Ù…ÙˆØ§ÙÙ‚Ø© ØªØ­ÙˆÙŠÙ„ Ø®Ø§Ø±Ø¬ÙŠ Ù„Ù„Ø­Ø§Ù„Ø© ' + target.id,
        details: 'Ø§Ù„ÙˆØ¬Ù‡Ø©: ' + destination + ' â€¢ Ø§Ù„Ø³Ø¨Ø¨: ' + reason,
        relatedEntityId: referral.id
      })
    });
    if (!consentResult.ok) {
      notify(consentResult.error || 'ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¥Ø­Ø§Ù„Ø© Ù„ÙƒÙ† ØªØ¹Ø°Ø± Ø¥Ù†Ø´Ø§Ø¡ Ø·Ù„Ø¨ Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø©.');
    }
  }

  if (window.confirm('ØªØ­Ù…ÙŠÙ„ Ù…Ù„Ù Ø§Ù„Ø¥Ø­Ø§Ù„Ø© PDF Ø§Ù„Ø¢Ù†ØŸ')) {
    var ok = await downloadBlobFromApi('/referrals/' + encodeURIComponent(referral.id) + '/pdf', 'referral-' + referral.id + '.pdf');
    if (!ok) {
      notify('ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¥Ø­Ø§Ù„Ø© Ù„ÙƒÙ† ØªØ¹Ø°Ø± ØªØ­Ù…ÙŠÙ„ Ù…Ù„Ù PDF.');
    }
  }
}

async function recordCaseAction(type, note, extra) {
  if (!activeCaseId) {
    notify('Ø§Ø®ØªØ± Ø­Ø§Ù„Ø© Ø£ÙˆÙ„Ù‹Ø§.');
    return false;
  }
  var payload = Object.assign({ type: type, note: note }, extra || {});
  var result = await SmartClinicSecurity.apiJson('/cases/' + encodeURIComponent(activeCaseId) + '/actions', {
    method: 'POST',
    body: JSON.stringify(payload)
  });
  if (!result.ok) {
    notify(result.error || 'ØªØ¹Ø°Ø± ØªÙ†ÙÙŠØ° Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡.');
    return false;
  }
  notify(note);
  await loadDoctorData();
  return true;
}

function bindDoctorShortcuts() {
  window.addEventListener('keydown', function (ev) {
    if (ev.defaultPrevented) return;
    var tag = ev.target && ev.target.tagName ? ev.target.tagName.toLowerCase() : '';
    if (tag === 'input' || tag === 'textarea' || tag === 'select') return;
    if (ev.key === '/') {
      ev.preventDefault();
      var search = document.getElementById('case-search');
      if (search) search.focus();
    }
  });
}

function renderDoctorAi(item) {
  if (!item) {
    latestDoctorAi = null;
    document.getElementById('ai-doctor-result').textContent = 'ØªØ¹Ø°Ø± Ø¹Ø±Ø¶ Ù†ØªÙŠØ¬Ø© AI.';
    return;
  }
  latestDoctorAi = item;
  var triage = item.smartTriage || null;
  var actions = buildAiActionPlan(item);
  var actionsHtml = actions.map(function (action, index) {
    var actionId = 'ai-action-' + index;
    return '<label class="ai-action-item" for="' + actionId + '">' +
      '<input type="checkbox" id="' + actionId + '" data-ai-action-index="' + index + '" checked>' +
      '<span><strong>' + actionLabel(action.type) + '</strong> - ' + action.note + '</span>' +
    '</label>';
  }).join('');

  var triageBlock = '';
  if (triage) {
    var triageClass = triage.classification || 'simple';
    var rationale = (triage.rationale || []).map(function (line) {
      return '<div class="mini-log-item">â€¢ ' + line + '</div>';
    }).join('');
    var triageActions = (triage.recommendation && triage.recommendation.actions ? triage.recommendation.actions : []).map(function (line) {
      return '<div class="mini-log-item">â€¢ ' + line + '</div>';
    }).join('');
    triageBlock =
      '<div class="triage-summary">' +
        '<div style="display:flex;gap:8px;align-items:center;flex-wrap:wrap;">' +
          '<span class="triage-chip ' + triageClass + '">' + (triage.classificationLabel || '-') + '</span>' +
          '<span style="color:var(--text-soft);font-size:12px;">Ø§Ù„Ø¯Ø±Ø¬Ø©: ' + (triage.score || 0) + '/100</span>' +
          '<span style="color:var(--text-soft);font-size:12px;">Ø§Ù„Ø«Ù‚Ø©: ' + Math.round(Number(triage.confidence || 0) * 100) + '%</span>' +
          '<span style="color:var(--text-soft);font-size:12px;">TRIAGE: ' + (triage.triageCode || '-') + '</span>' +
        '</div>' +
        '<div style="margin-top:8px;"><strong>Ø§Ù„ØªÙˆØµÙŠØ© Ø§Ù„Ø£ÙˆÙ„ÙŠØ©:</strong> ' + ((triage.recommendation && triage.recommendation.primary) || '-') + '</div>' +
        '<div style="margin-top:6px;color:var(--text-soft);">Ø§Ù„Ø¨Ø±ÙˆØªÙˆÙƒÙˆÙ„: ' + ((triage.protocol && triage.protocol.id) || '-') + ' - ' + ((triage.protocol && triage.protocol.title) || '-') + '</div>' +
        '<div style="margin-top:8px;color:var(--text-soft);">Ù…Ø¨Ø±Ø±Ø§Øª Ø§Ù„Ù‚Ø±Ø§Ø±</div>' +
        (rationale || '<div class="mini-log-item">â€¢ Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø¨Ø±Ø±Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©.</div>') +
        '<div style="margin-top:8px;color:var(--text-soft);">Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„Ø¨Ø±ÙˆØªÙˆÙƒÙˆÙ„</div>' +
        (triageActions || '<div class="mini-log-item">â€¢ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ù…Ù‚ØªØ±Ø­Ø©.</div>') +
      '</div>';
  }

  var priorityLabel = item.priority === 'immediate' ? 'ÙÙˆØ±ÙŠ' : (item.priority === 'urgent' ? 'Ø¹Ø§Ø¬Ù„' : 'Ù‚ÙŠØ§Ø³ÙŠ');
  var checklist = (item.checklist || []).map(function (x) { return '<div class="mini-log-item">â€¢ ' + x + '</div>'; }).join('');
  var plan = (item.carePlan || []).map(function (x) { return '<div class="mini-log-item">â€¢ ' + x + '</div>'; }).join('');
  document.getElementById('ai-doctor-result').innerHTML =
    '<div><strong>Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ©: ' + priorityLabel + ' | TRIAGE: ' + (item.triage || '-') + '</strong></div>' +
    '<div style="margin-top:6px;color:var(--text-soft);">ØªÙˆØµÙŠØ© Ø±Ø¦ÙŠØ³ÙŠØ©: ' + (item.recommendation || '-') + '</div>' +
    triageBlock +
    '<div style="margin-top:8px;color:var(--text-soft);">Checklist ØªÙ†ÙÙŠØ°ÙŠ</div>' + checklist +
    '<div style="margin-top:8px;color:var(--text-soft);">Ø®Ø·Ø© Ø±Ø¹Ø§ÙŠØ© Ù…Ù‚ØªØ±Ø­Ø©</div>' + plan +
    '<div style="margin-top:10px;color:var(--text-soft);">Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª AI Ø§Ù„Ù…Ù‚ØªØ±Ø­Ø© (Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„ØªØ­Ø¯ÙŠØ¯)</div>' +
    '<div class="ai-actions">' + actionsHtml + '</div>' +
    '<div style="margin-top:10px;display:flex;gap:8px;flex-wrap:wrap;">' +
      '<button class="btn-success" onclick="applyDoctorAiPlan()">ØªÙ†ÙÙŠØ° Ø§Ù„Ù…Ø­Ø¯Ø¯</button>' +
      '<button class="ghost-btn" onclick="selectAllAiActions(true)">ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ÙƒÙ„</button>' +
      '<button class="ghost-btn" onclick="selectAllAiActions(false)">Ø¥Ù„ØºØ§Ø¡ Ø§Ù„ÙƒÙ„</button>' +
    '</div>';
}

async function runDoctorAi() {
  if (!activeCaseId) {
    notify('Ø§Ø®ØªØ± Ø­Ø§Ù„Ø© Ø£ÙˆÙ„Ù‹Ø§.');
    return;
  }
  var note = document.getElementById('ai-doctor-note').value.trim();
  var complaint = document.getElementById('ai-doctor-complaint').value.trim();
  var result = await SmartClinicSecurity.apiJson('/ai/doctor-support', {
    method: 'POST',
    body: JSON.stringify({ caseId: activeCaseId, note: note, complaint: complaint })
  });
  if (!result.ok || !result.data) {
    notify(result.error || 'ÙØ´Ù„ ØªØ­Ù„ÙŠÙ„ AI Ù„Ù„Ø·Ø¨ÙŠØ¨.');
    return;
  }
  renderDoctorAi(result.data.item || null);
  notify('ØªÙ… ØªØ­Ø¯ÙŠØ« ØªÙˆØµÙŠØ© AI Ù„Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ù†Ø´Ø·Ø©.');
}

function buildAiActionPlan(ai) {
  var plan = [];
  if (!ai) return plan;
  var triage = ai.smartTriage || null;
  var triageClass = triage ? triage.classification : '';

  if (ai.priority === 'immediate' || triageClass === 'immediate') {
    plan.push({ type: 'emergency_protocol', note: 'ØªÙ†ÙÙŠØ° AI: ØªÙØ¹ÙŠÙ„ Ø¨Ø±ÙˆØªÙˆÙƒÙˆÙ„ Ø§Ù„Ø·ÙˆØ§Ø±Ø¦' });
  }

  if (ai.sla && ai.sla.breached) {
    plan.push({ type: 'external_referral', note: 'ØªÙ†ÙÙŠØ° AI: ØªØ­ÙˆÙŠÙ„ Ø®Ø§Ø±Ø¬ÙŠ Ø¨Ø³Ø¨Ø¨ ØªØ¬Ø§ÙˆØ² SLA' });
  }

  if (triageClass === 'follow_up') {
    plan.push({ type: 'contact_guardian', note: 'ØªÙ†ÙÙŠØ° AI: Ø¥Ø¨Ù„Ø§Øº ÙˆÙ„ÙŠ Ø§Ù„Ø£Ù…Ø± Ø¨Ù…ØªØ·Ù„Ø¨Ø§Øª Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ø·Ø¨ÙŠØ©' });
  }

  plan.push({ type: 'vitals_update', note: 'ØªÙ†ÙÙŠØ° AI: ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ù„Ø§Ù…Ø§Øª Ø§Ù„Ø­ÙŠÙˆÙŠØ© Ù„Ù„Ø­Ø§Ù„Ø©' });
  plan.push({ type: 'careplan_save', note: 'ØªÙ†ÙÙŠØ° AI: Ø­ÙØ¸ Ø®Ø·Ø© Ø§Ù„Ø±Ø¹Ø§ÙŠØ© Ø§Ù„Ù…Ù‚ØªØ±Ø­Ø©', plan: (ai.carePlan || []).join(' | ') });
  return plan;
}

function selectedAiActions(allActions) {
  var selected = [];
  for (var i = 0; i < allActions.length; i += 1) {
    var check = document.querySelector('[data-ai-action-index="' + i + '"]');
    if (check && check.checked) {
      selected.push(allActions[i]);
    }
  }
  return selected;
}

function selectAllAiActions(checked) {
  var checks = document.querySelectorAll('[data-ai-action-index]');
  checks.forEach(function (box) {
    box.checked = Boolean(checked);
  });
}

async function applyDoctorAiPlan() {
  if (!latestDoctorAi) {
    notify('Ø´ØºÙ‘Ù„ ØªØ­Ù„ÙŠÙ„ AI Ø£ÙˆÙ„Ù‹Ø§ Ø«Ù… Ù†ÙÙ‘Ø° Ø§Ù„Ø®Ø·Ø©.');
    return;
  }

  var actions = selectedAiActions(buildAiActionPlan(latestDoctorAi));
  if (!actions.length) {
    notify('Ø§Ø®ØªØ± Ø¥Ø¬Ø±Ø§Ø¡ ÙˆØ§Ø­Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„ Ù„Ù„ØªÙ†ÙÙŠØ°.');
    return;
  }

  if (!window.confirm('ØªØ£ÙƒÙŠØ¯ ØªÙ†ÙÙŠØ° ' + actions.length + ' Ø¥Ø¬Ø±Ø§Ø¡ Ø¹Ù„Ù‰ Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ù†Ø´Ø·Ø©ØŸ')) {
    return;
  }

  try {
    for (var i = 0; i < actions.length; i += 1) {
      var action = actions[i];
      var result = await SmartClinicSecurity.apiJson('/cases/' + encodeURIComponent(activeCaseId) + '/actions', {
        method: 'POST',
        body: JSON.stringify({
          type: action.type,
          note: action.note,
          plan: action.plan || ''
        })
      });
      if (!result.ok) {
        notify(result.error || 'ÙØ´Ù„ ØªÙ†ÙÙŠØ° Ø¬Ø²Ø¡ Ù…Ù† Ø§Ù„Ø®Ø·Ø©.');
        return;
      }
    }

    notify('ØªÙ… ØªÙ†ÙÙŠØ° Ø®Ø·Ø© AI Ù„Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ù†Ø´Ø·Ø© Ø¨Ù†Ø¬Ø§Ø­.');
    await loadDoctorData();
    await runDoctorAi();
  } catch (err) {
    notify('ØªØ¹Ø°Ø± ØªÙ†ÙÙŠØ° Ø®Ø·Ø© AI ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§.');
  }
}

window.addEventListener('DOMContentLoaded', function () {
  SmartClinicSecurity.requireAccess(['doctor', 'admin'], 'Ù„ÙˆØ­Ø© Ø§Ù„Ø·Ø¨ÙŠØ¨');
  if (window.SmartClinicUI) {
    SmartClinicUI.mountQuickNav({
      afterSelector: '.sc-page-header',
      onRefresh: loadDoctorData,
      links: [
        { label: 'Ù„ÙˆØ­Ø© Ø§Ù„Ø·Ø¨ÙŠØ¨', href: 'doctor.html' },
        { label: 'Ù…Ø±ÙƒØ² Ø§Ù„ØªÙ†Ø³ÙŠÙ‚', href: 'care-center.html' },
        { label: 'Ø§Ù„Ø­Ø§Ù„Ø©', href: 'case-details.html?id=case_1' },
        { label: 'Ø§Ù„Ø·ÙˆØ§Ø±Ø¦', href: 'emergency-flow.html?id=case_1' },
        { label: 'Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª', href: 'notifications-center.html' }
      ]
    });
  }
  bindDoctorShortcuts();
  SmartClinicSecurity.createAutoRefresh(loadDoctorData, 15000, { immediate: true });
});
</script>
</body>
</html>
